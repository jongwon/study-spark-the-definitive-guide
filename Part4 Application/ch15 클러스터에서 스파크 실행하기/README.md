# 15. 클러스터에서 실행하기

- 스파크 애플리케이션의 아키텍쳐와 컴포넌트
- 내/외부에서 실행되는 스파크 애플리케이션의 생애주기
- 저수준 실행 속성
- 스파크 애플리케이션을 실행하는데 필요한 사항

## 15.1 Spark 애플리케이션 아키텍쳐

#### 스파크 드라이버

- **운전자역할**을 하는 프로세스로 실행에 필요한 모든 상태와 자원을 요청하고 관리한다.
- 애플리케이션의 실행을 제어하고 스파크 클러스터의 모든 상태정보를 유지한다.
- 클러스터 매니저와 통신해 물리적 자원을 확보하고 실행한다.

#### 스파크 Executor

- 스파크 드라이버가 할당한 태스크를 수행하는 프로세스
- 드라이버가 할당한 태스크를 실행하고 상태와 결과를 드라이버에게 보고한다.

#### 클러스터 매니저

- 클러스터 드라이버(마스터)와 워커로 구분된다.
- 워커는 애플리케이션을 실행합니다.
- 클러스터 매니저는 아래 3가지 이고 추후에 추가될 수 있다.
  - Standalone
  - MESOS
  - YARN

### 스파크의 실행 모드

애플리케이션을 실행할 물리적 자원의 위치를 결정하는 값으로 아래 세가지가 있다.

#### 클러스터 모드(cluster)

- 가장 일반적인 모드
- 컴파일된 jar나 파이썬 스크립트, R 스크립트를 클러스터 매니저에게 전달해야 함
- 클러스터 매니저는 파일을 받은 다음 driver 프로세스와 executor 프로세스를 워커노드에 할당받아 실행한다.

#### 클라이언트 모드 (client)

- 스파크 드라이버가 클러스터의 워커노드가 아닌 클라이언트 측에 위치한다.
- 클러스터 매니저는 Executor 만 워커노드에 할당해 실행한다.
- 클러스터 밖에 드라이버가 위치하는 것을 게이트웨이 머신 혹은 에지 노드라고 부른다.

#### 로컬 모드(local)

- 학습이나 테스트 혹은 개발버전에서 사용한다.
- 드라이버와 Executor가 단일 머신에서 동작한다.

## 15.2 외부 생애주기

#### 1. 클라이언트 요청

- 컴파일된 jar 파일과 라이브러리 파일을 함께 제출한다.
- 클라이언트 프로세스에서 제출을 하면 스파크 드라이버 노드가 할당이 되고, 해당 드라이버 노드는 컴파일된 파일을 받아들이고 스파크 애플리케이션을 받아들이고 클라이언트 프로세스는 종료가 된다.
- spark-submit 명령 포멧

  ```
  ./bin/spark-submit \
    --class <main-class> \
    --master <master-url> \
    --deploy-mode cluster \
    --conf <key>=<value> 기타 다른 옵션 \
    <applicaiton.jar> arg1 arg2 ...

  ```

#### 2. 시작

-

#### 3. 실행

#### 4. 완료

## 15.3 내부 생애주기

## 15.4 세부 실행 과정

## 15.5 정리
